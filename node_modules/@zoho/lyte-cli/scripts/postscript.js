var path = require("path");
var fs = require("fs");
var cli = require(path.join(process.cwd(),"lib","cli","cli"));
var packageJSONcontentObj = JSON.parse(fs.readFileSync("package.json"),"utf-8");
let count = 0;
let totalCount =0;
let cb = function(cliAddons) {
    return new Promise(function(resolve,reject) {
        console.log("Adding cli addons ...");
        for(let key in cliAddons) {
            count++;
            commandsJSONpath = JSON.parse(fs.readFileSync("commands.json",'utf-8'));
            cli({
                cliRoot : process.cwd(),
                root : process.cwd(),
                cliArgs : ["add",key,'--version='+cliAddons[key],'--nospinner']
            }).then(function(){
                console.log("cli addons "+key+" added");
                if(count == totalCount) {
                    console.log("All cli addons");
                    resolve();
                }
            }).catch(function(e){
                console.log(e.message);
                reject(e);
            });
        }
    });
};
let len;
let cliAddonsInLyteCli = packageJSONcontentObj["cli-addons"];
if(cliAddonsInLyteCli && (len = Object.keys(cliAddonsInLyteCli).length)) {
    totalCount += len;
    cb(cliAddonsInLyteCli);
}
var basePath = process.argv[2];
var appPath = path.join(basePath,"package.json");
if(fs.existsSync(appPath)) {
    let appPackageJSON = JSON.parse(fs.readFileSync(appPath,'utf-8'));
    let appCliAddons = appPackageJSON["cli-addons"];
    if(appCliAddons && (len = Object.keys(appCliAddons).length)) {
        totalCount += len;
        cb(appCliAddons);
    }
}

